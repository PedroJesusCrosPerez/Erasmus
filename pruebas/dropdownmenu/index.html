<style>
  .contenido{
    display: none;
  }
  
  /*.PruebaSprite{
    padding-left:19px;
    background: transparent url("  https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -27px;
  }
  
  .PruebaSprite-fin{
    padding-left:19px;
    background: transparent url("  https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -5px;
  }*/
  
  .listaPermisos{
    display: inline-block;
  }
  .listaPermisos,
  .listaPermisos ul {  
    list-style-type: none;
    margin-left: 0;
    padding-left: 30px;
  }
  
  .listaPermisos > li > ul > li div{
        padding-left:19px;  
  }
  
  /*Segundo Nivel */
  .listaPermisos > li > ul > li:not(:last-child) > div{
    background: transparent url("https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -27px;  
  }
  
  /*Segundo Nivel */
  .listaPermisos > li > ul > li:last-child > div{
    background: transparent url("https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -5px;  
  }
  
  
  /*Tercer nivel*/
  .listaPermisos > li > ul > li:not(:last-child) > ul {  
    background: transparent url("https://sites.google.com/a/bbva.com/gdd_app/treeBranch.png") repeat-y scroll -8px -44px;  
  }
  
  /*Tercer nivel y siguientes*/
  .listaPermisos > li > ul > li > ul > li:last-child div{
    background: transparent url("https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -5px;  
  }
  
  /*Tercer nivel y siguientes*/
  .listaPermisos > li > ul > li > ul > li:not(:last-child) div{
    background: transparent url("https://sites.google.com/a/bbva.com/gdd_app/treeview.png") no-repeat scroll -3px -5px;  
  }
  
  
  .triCheckbox {
    display: inline-block;
    cursor: pointer;
    -webkit-touch-callout: none;
    /*Todo esto es para que no se pueda seleccionar el texto */
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    padding-right: 5px;  
    margin-bottom: 2px;
  }
  
  .triCheckbox[data-estado="-1"] > span {
    background-color: red;
  /*  text-decoration: line-through;*/
  }
  
  .triCheckbox[data-estado="0"] > span {
    background-color: blue;
  }
  
  .triCheckbox[data-estado="1"] > span {
    background-color: green;
  }
</style>


<div class="desplegable"><span>Click</span>
  <div class="contenido">
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>General</span></div>
        <ul>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Notificaciones</span></div>
          </li>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Contactar</span></div>
          </li>
        </ul>
      </li>
    </ul>
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>Sin Hijos</span></div>
      </li>
    </ul>
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>Peticiones</span></div>
        <ul>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Nueva Peticion</span></div>
          </li>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Mis Peticiones</span></div>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div>
<div class="desplegable"><span>Click</span>
  <div class="contenido">
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>General</span></div>
        <ul>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Notificaciones</span></div>
          </li>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Contactar</span></div>
          </li>
        </ul>
      </li>
    </ul>
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>Sin Hijos</span></div>
      </li>
    </ul>
    <ul class="listaPermisos">
      <li>
        <div class="triCheckbox" data-estado="-1"><span>Peticiones</span></div>
        <ul>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Nueva Peticion</span></div>
          </li>
          <li>
            <div class="triCheckbox" data-estado="-1"><span>Mis Peticiones</span></div>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div>

<script>
  // Manejar clic en elementos con clase "desplegable"
  var desplegables = document.querySelectorAll(".desplegable > span");
  desplegables.forEach(function (desplegable) {
      desplegable.addEventListener("click", function () {
          var contenido = this.nextElementSibling;
          if (contenido.style.display === "block") {
              contenido.style.display = "none";
          } else {
              contenido.style.display = "block";
          }
      });
  });

  // Manejar clic en elementos con clase "triCheckbox"
  var triCheckboxes = document.querySelectorAll(".triCheckbox");
  triCheckboxes.forEach(function (triCheckbox) {
      triCheckbox.addEventListener("click", function () {
          var estado = Number(this.getAttribute("data-estado"));
          if (estado === 1) {
              estado = -2;
          }

          estado += 1;

          // Comprobar si estamos en padre o en hijo.
          var liPadre = findParentLi(this);

          if (liPadre && liPadre.querySelectorAll('ul').length >= 2) {
              // Entonces el elemento es un hijo

              // Si estamos en el hijo dando permisos, dárselos al padre.
              var permisoPadre = liPadre.closest('ul').closest('li').querySelector('.triCheckbox');
              if (estado !== -1 && permisoPadre.getAttribute("data-estado") == -1) {
                  permisoPadre.setAttribute("data-estado", 0);
              }

          } else {
              // Si estamos quitando permisos, quitar a los hijos
              if (estado == -1) {
                  var hijosCheckbox = liPadre.querySelectorAll(".triCheckbox");
                  hijosCheckbox.forEach(function (hijoCheckbox) {
                      hijoCheckbox.setAttribute("data-estado", estado);
                  });
              }
          }

          this.setAttribute("data-estado", estado);
      });
  });

  // Función para encontrar el padre LI de un elemento
  function findParentLi(element) {
      var parent = element.parentNode;
      while (parent && parent.tagName !== "LI") {
          parent = parent.parentNode;
      }
      return parent;
  }
</script>
